#!/bin/bash

# This script will delete locally all merged branches
# It will ignores branches such master, dev, staging, etc...

set -o nounset
set -o errexit
set -o pipefail
#set -x

info() {
    echo -e "\x1b[97m\xE2\x87\x92 \x1b[0m $1"
}

error() {
    echo -e "\x1b[41m\x21 \x1b[0m $1" 1>&2
    exit 1
}

warning() {
    echo -e "\x1b[35m\x21 \x1b[0m $1"
}

info "Working directory: $(pwd -P)"

declare -r branches=($(git branch --merged | grep -v "\*" | grep -v master | grep -v dev | grep -v stage | grep -v staging))

if [[ ${#branches[@]} -eq 0 ]];
then
    info "No branches to delete!"
else

    info "The following branches will be deleted locally:"

    for branch in ${branches[@]}
    do
        echo -e "\t- ${branch}"
    done

    read -e -p "Do you want to proceed? [y/N]: " answer

    if [[ ${answer} == "y" ]]; then

        for branch in ${branches[@]}
        do
            warning "\xE2\x98\xA0 ${branch}"
            git branch -d "${branch}"
        done

    else
        info "Skipped!"
    fi
fi

exit 0

