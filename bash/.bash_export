#!/bin/bash

get_composer_bin_path() {
    local composer_home="$HOME/.composer"
    local composer_bin=

    if [[ -d $composer_home ]]; then
        composer_bin="${composer_home}/vendor/bin"
        [[ -d $composer_bin ]] || mkdir -p $composer_bin
    fi
    echo $composer_bin
}

get_gem_path() {
    local ruby_path=$(ruby -e 'print Gem.user_dir')
    local gem_bin="${ruby_path}/bin"
    echo $gem_bin
}

get_dotfiles_path() {
    local this_file=$(readlink ${BASH_SOURCE[0]})
    local df_dir=$(cd "$(dirname "${this_file}")/.." && pwd)
    echo $df_dir
}

has_vagrant_user() {
    grep -q '^vagrant:' /etc/passwd && echo true
}

is_vagrant_machine() {
    has_vagrant_user || echo false
}

# am I in a vagrant machine?
export IS_VAGRANT=$(is_vagrant_machine)

# Add relevant bin paths
export PATH="$HOME/bin:$(get_dotfiles_path)/bin:$(get_gem_path):$(get_composer_bin_path):$PATH"

# GO configuration
export GOPATH="$HOME/dev/go"

# Python configuration
export PIP_REQUIRE_VIRTUALENV=true
export PIP_DOWNLOAD_CACHE="$HOME/.pip/cache"

#Javascript configuration
export NODE_ENV='development'

[[ -d "$HOME/.nvm" ]] && export NVM_DIR="$HOME/.nvm"
[[ -s "$NVM_DIR/nvm.sh" ]] && . "$NVM_DIR/nvm.sh"
[[ -d "$HOME/.yarn" ]] && export PATH="$HOME/.yarn/bin:$PATH"

# https://wiki.archlinux.org/index.php/Color_output_in_console#less
export LESSOPEN="| /usr/bin/source-highlight-esc.sh %s"
#export LESSOPEN='|/usr/bin/lesspipe.sh %s'
export LESS=' -R '
export LESS_TERMCAP_mb=$'\E[1;31m'
export LESS_TERMCAP_md=$'\E[1;36m'
export LESS_TERMCAP_me=$'\E[0m'
export LESS_TERMCAP_se=$'\E[0m'
export LESS_TERMCAP_so=$'\E[01;44;33m'
export LESS_TERMCAP_ue=$'\E[0m'
export LESS_TERMCAP_us=$'\E[1;32m'

# don't put duplicate lines or lines starting with space in the history.
# See bash(1) for more options
export HISTCONTROL=ignoreboth

# for setting history length see HISTSIZE and HISTFILESIZE in bash(1)
export HISTSIZE=10000
export HISTFILESIZE=20000

# Change grep matches color
export GREP_COLOR='1;97;101'

# Default text editor
export EDITOR=/usr/bin/vim

# unstaged (*) and staged (+) changes will be shown next to the branch name
export GIT_PS1_SHOWDIRTYSTATE=1

# If something is stashed, then a '$' will be shown next to the branch name.
# export GIT_PS1_SHOWSTASHSTATE=1

# If there're untracked files, then a '%' will be shown next to the branch name
export GIT_PS1_SHOWUNTRACKEDFILES=1

# "<" indicates you are behind,
# ">" indicates you are ahead,
# "<>" indicates you have diverged
# "=" indicates that there is no difference
export GIT_PS1_SHOWUPSTREAM="auto"

